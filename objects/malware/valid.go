// Copyright 2015-2020 Bret Jordan, All rights reserved.
//
// Use of this source code is governed by an Apache 2.0 license that can be
// found in the LICENSE file in the root of the source tree.

package malware

import (
	"errors"

	"github.com/freetaxii/libstix2/resources/helpers"
	"github.com/freetaxii/libstix2/vocabs"
)

// ----------------------------------------------------------------------
// Public Methods
// ----------------------------------------------------------------------

/*
Valid - This method will verify and test all of the properties on the object to
make sure they are valid per the specification.
*/
func (o *Malware) Valid() (bool, error) {

	// Check common base properties first
	if valid, err := o.CommonObjectProperties.Valid(); valid != true {
		return false, err
	}

	// Check Malware Specific Properties
	if valid, err := o.validMalwareTypes(); valid == false {
		return valid, err
	}

	if valid, err := o.validArchitectureExecutionEnvs(); valid == false {
		return valid, err
	}

	if valid, err := o.validImplementationLanguages(); valid == false {
		return valid, err
	}

	if valid, err := o.validCapabilities(); valid == false {
		return valid, err
	}

	return true, nil
}

// ----------------------------------------------------------------------
// Private Methods
// ----------------------------------------------------------------------

func (o *Malware) validMalwareTypes() (bool, error) {
	if len(o.MalwareTypes) == 0 {
		return false, errors.New("the MalwareTypes property is required, but missing")
	}

	return helpers.ValidSlice("MalwareTypes", o.MalwareTypes, vocabs.MalwareType)
}

func (o *Malware) validArchitectureExecutionEnvs() (bool, error) {
	return helpers.ValidSlice("ArchitectureExecutionEnvs", o.ArchitectureExecutionEnvs, vocabs.ProcessorArchitecture)
}

func (o *Malware) validImplementationLanguages() (bool, error) {
	return helpers.ValidSlice("ImplementationLanguages", o.ImplementationLanguages, vocabs.ImplementationLanguage)
}

func (o *Malware) validCapabilities() (bool, error) {
	return helpers.ValidSlice("Capabilities", o.Capabilities, vocabs.MalwareCapabilities)
}
